def dockerImageName = 'commercetools/commercetools-project-sync:' + version
docker {
    javaApplication {
        baseImage = 'adoptopenjdk/openjdk11:jre'
        maintainer = 'PS Team Munich [ps-dev@commercetools.com]'
        images = [dockerImageName]
        ports = []
    }
    registryCredentials {
        username = System.getenv('DOCKER_USERNAME')
        password = System.getenv('DOCKER_PASSWORD')
    }
}

task dockerBuildxCreate(type:Exec) {
    group 'docker'
    dependsOn dockerCreateDockerfile
    workingDir 'build/docker'
    executable 'docker'
    args = ['buildx', 'create', '--use']
}

task dockerBuildxImage(type:Exec) {
    group 'docker'
    dependsOn dockerBuildxCreate
    workingDir 'build/docker'
    executable 'docker'
    args = ['buildx', 'build', '--platform', 'linux/amd64,linux/arm64/v8', '--tag', dockerImageName, '--push', '.']
}
